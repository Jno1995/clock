{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\customComponents/assets\\scripts\\customComponents\\customSprite.js"],"names":["bgTextureEnum","cc","Enum","Null","Bg_1","Bg_2","spriteModeEnum","Bg","Disperse","customSprite","Class","extends","Sprite","editor","disallowMultiple","executeInEditMode","menu","properties","bgTexture","default","type","displayName","notify","onLoadTexture2DToSprite","fileName","disperseName","multiline","onSpriteNameToAtlasEvent","disperseIndex","Integer","onSpriteFrameIndexToAtlasEvent","disperse","_oldDefaultTexture2D","_oldSpriteFrame","_applyAtlas","CC_EDITOR","spriteFrame","self","_atlasUuid","AssetLibrary","loadAsset","err","asset","_atlas","textureUrl","url","raw","loader","load","resTexture2D","newSpriteFrame","SpriteFrame","getSpriteFrames","length","error","i","name","Attr","setClassAttr"],"mappings":"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","file":"customSprite.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\customComponents","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nvar bgTextureEnum = cc.Enum({\r\n    Null: 0,\r\n    Bg_1: 1,\r\n    Bg_2: 2,\r\n});\r\n\r\nconst spriteModeEnum = cc.Enum({\r\n    Bg: 0,\r\n    Disperse: 1,\r\n});\r\n\r\n//自定义精灵组件  默认为图集模式\r\n\r\nlet customSprite = cc.Class({\r\n    extends: cc.Sprite,\r\n    \r\n    editor: {\r\n        disallowMultiple: true,\r\n        executeInEditMode: true,\r\n        menu: \"自定义组件/自定义精灵组件\",\r\n    },\r\n\r\n    properties: {\r\n        bgTexture: {\r\n            default: bgTextureEnum.Null,\r\n            type: bgTextureEnum,\r\n            displayName: \"图片精灵背景贴图枚举\",\r\n            notify: function () {\r\n                this.onLoadTexture2DToSprite();\r\n            }\r\n        },\r\n\r\n        fileName: {\r\n            default: \"bg\",\r\n            displayName: \"散图文件夹\"\r\n        },\r\n\r\n        disperseName: {\r\n            default: \"null\",\r\n            displayName: \"搜索图片\",\r\n            multiline: false,\r\n            notify: function () {\r\n                this.onSpriteNameToAtlasEvent();\r\n            }\r\n        },\r\n\r\n        disperseIndex: {\r\n            default: 0,\r\n            type: cc.Integer,\r\n            displayName: \"散图序号\",\r\n            notify: function () {\r\n                this.onSpriteFrameIndexToAtlasEvent();\r\n            }\r\n        },\r\n\r\n        disperse: {\r\n            default: true,\r\n            displayName: \"图集模式\"\r\n        },\r\n\r\n        _oldDefaultTexture2D: null,\r\n        _oldSpriteFrame: null,\r\n    },\r\n\r\n    _applyAtlas: CC_EDITOR && function (spriteFrame) {\r\n        // Set atlas\r\n        var self = this;\r\n        if (spriteFrame && spriteFrame._atlasUuid) {\r\n            \r\n            cc.AssetLibrary.loadAsset(spriteFrame._atlasUuid, function (err, asset) {\r\n                self._atlas = asset;\r\n            });\r\n        } else {\r\n            this._atlas = null;\r\n        }\r\n        self.disperseName = \"\";\r\n    },\r\n\r\n    onLoadTexture2DToSprite () {\r\n        this.textureUrl = cc.url.raw(`res/texture/${this.fileName}/${this.fileName+this.bgTexture}.png`);\r\n        if (this.bgTexture !== bgTextureEnum.Null) {\r\n            cc.loader.load(this.textureUrl, (err, resTexture2D)=> {\r\n                this.spriteFrame = null;\r\n                let newSpriteFrame = new cc.SpriteFrame(resTexture2D);\r\n                if (this._oldSpriteFrame !== newSpriteFrame) {\r\n                    this.spriteFrame = newSpriteFrame;\r\n                    this._oldSpriteFrame = this.spriteFrame;\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.spriteFrame = null;\r\n        }\r\n    },\r\n\r\n    onSpriteFrameIndexToAtlasEvent () {\r\n        if (this.disperseIndex !== -1) {\r\n            if (this.disperse && this._atlas) {\r\n                if (this.disperseIndex >= 0 && this.disperseIndex < this._atlas.getSpriteFrames().length) {\r\n                    this.spriteFrame = this._atlas.getSpriteFrames()[this.disperseIndex];\r\n                }\r\n                else {\r\n                    if (this.disperseIndex < this._atlas.getSpriteFrames().length / 2) {\r\n                        this.disperseIndex = 0;\r\n                    }\r\n                    else {\r\n                        this.disperseIndex = this._atlas.getSpriteFrames().length -1;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                cc.error(\"请将图集文件拖入Atlas框中\");\r\n            }\r\n        }\r\n    },\r\n\r\n    onSpriteNameToAtlasEvent () {\r\n        if (this.disperseName !== \"\") {\r\n            if (this.disperse && this._atlas) {\r\n                for (let i = 0; i < this._atlas.getSpriteFrames().length; i++) {\r\n                    if (this._atlas.getSpriteFrames()[i].name === this.disperseName) {\r\n                        this.spriteFrame = this._atlas.getSpriteFrames()[i];\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                cc.error(\"请将图集文件拖入Atlas框中\");\r\n            }\r\n        }\r\n    }\r\n\r\n});\r\n\r\nif (CC_EDITOR) {\r\n    cc.Class.Attr.setClassAttr(customSprite, 'bgTexture', 'visible', function() {\r\n        return !this.disperse;\r\n    });\r\n    cc.Class.Attr.setClassAttr(customSprite, 'fileName', 'visible', function() {\r\n        return !this.disperse;\r\n    });\r\n    cc.Class.Attr.setClassAttr(customSprite, 'disperseIndex', 'visible', function() {\r\n        return this.disperse;\r\n    });\r\n    cc.Class.Attr.setClassAttr(customSprite, 'disperseName', 'visible', function() {\r\n        return this.disperse;\r\n    });\r\n}\r\n"]}