{"version":3,"sources":["WXHelper.js"],"names":["WXHelper","authScopeUserInfo","sessionID","isLoadingShow","requestURL","inited","userInfoBtn","downloadTotalCountArr","downloadCompleteCountArr","downloadProgress","openId","weChatKey","RankHeight","shareTicket","scene","_initGroupRankIndex","_isReadyGroupRank","_isShowGroupRank","_groupRankNode","_groupRankCanvasWidth","_groupRankCanvasHeight","_isCollect","_queryData","init","self","cc","vv","const","WX_REQUEST_URL","keepScreenOn","wx","onHide","console","log","groupRankNode","find","gameEvent","dispatchEvent","EVENT_ENTER_BACKGROUND","onShow","res","WX_SCENE_VALUE_1044","matchData","isMatch","myself","guideStep","query","inviterId","postMessage","command","keyData","myOpenId","initGroupIndex","getComponent","initView","inviterInitType","inviterInitModule","enum","EnumInitView","EIV_GROUP","utils","createPrefabByUrl","URL_GROUP_RANK","node","EVENT_WX_QUERY","WX_SCENE_VALUE_1104","gameNetMgr","tryReconnectLogicServer","EVENT_ENTER_FOREGROUND","onAudioInterruptionBegin","EVENT_AUDIO_INTERRUPTION_BEGIN","onAudioInterruptionEnd","EVENT_AUDIO_INTERRUPTION_END","onShareAppMessage","playerId","playerName","title","lan","SHARE_TITLE_GAME","imageUrl","WX_SHARE_GAME_URL","getUpdateManager","updateManager","onCheckForUpdate","hasUpdate","onUpdateReady","applyUpdate","onUpdateFailed","iswxPlatform","sys","platform","WECHAT_GAME","setClipboardData","data","_callback","success","save","e","clipboardData","setData","preventDefault","bind","document","addEventListener","execCommand","removeEventListener","showLoading","mask","hideLoading","showShareMenu","updateShareMenu","type","withShareTicket","fail","getShareInfo","errMsg","encryptedData","iv","request","url","method","statusCode","Data","openGId","complete","hideShareMenu","shareAppMessageScn","shareAppMessage","canvas","toTempFilePathSync","destWidth","destHeight","shareAppMessageQuery","successCallback","failCallback","sceneID","pw","PacketWriter","writeid","packid","PACKETID_249","writeu2","writeu1","socketMgr","bufferPack","getdata","login","_authorize","_login","_successCb","successCb","getSetting","authSetting","screenWidth","screenHeight","getSystemInfo","imgurl","raw","GameTexture","wxmingamelogin","createUserInfoButton","image","text","style","left","wxmingamelogin_width","top","wxmingamelogin_height","width","height","borderRadius","onTap","authorize","scope","destroy","loadLocalSessionID","session","getStorageSync","_getUserInfo","failCb","getUserInfo","withCredentials","userInfoObj","downloadAllResources","target","callFunc","fileArr","GameConst","URL_RES_INCLUDE_FILE","i","length","loader","loadResDir","completedCount","totalCount","item","dealDownloadProgress","err","assets","error","index","cur","getProgress","max","Math","floor","arr","num","setShareCanvasGameAwardData","masterPoint","bonus","totalBonus","nickName","getSubstringDataByLength","headImgUrl","playerIcon","getCustomShareCanvasToShare","sharedCanvas","toTempFilePath","x","y","fileType","quality","tempFilePath","getScreenCanvasToLocalPath","failCallBack","saveImageToPhotosAlbum","showModal","content","filePath","downloadSharedCanvasResources","fs","getFileSystemManager","downloadFile","wxDownloader","REMOTE_SERVER_ROOT","path","getFriendRank","getAnswerRank","myName","myHeadUrl","myTime","answerCounTime","friendRankPageActiveChange","pIndex","setRankHeight","setConfigFriendRankData","keyArr","bonusData","masterPointData","answerTime","key","setMoveTouchDeltaY","deltaY","setMoveTouchOff","setSharedCanvasChildrenActive","setSharedCanvasSize","setSharedCanvasDesignResolution","designWidth","designHeight","getSurpassFriendData","initLoadGroupRankVieW","setKeepScreenOn","module","exports"],"mappings":"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AACAH,WAAGsJ,WAAH,CAAe;;AAEXC,6BAAiB,IAFN,EAEY;;AAEvBtF,qBAAS,iBAACvD,GAAD,EAAS;AACd,sBAAK8I,WAAL,GAAmB9I,GAAnB;AACAR,wBAAQC,GAAR,CAAY,0BAAZ;AACA,oBAAI,OAAOqH,SAAP,KAAqB,UAAzB,EAAqC;AACjCA;AACH;AACD;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AAlIU,SAAf;AAoIH,KA/nBY;;;AAooBb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;A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","file":"WXHelper.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\third","sourcesContent":["const WXHelper = {\r\n    authScopeUserInfo: false, // 是否已授权获取用户信息\r\n    sessionID: null,\r\n    isLoadingShow: false,\r\n    requestURL: null,\r\n    inited: false,\r\n    userInfoBtn: null,\r\n    downloadTotalCountArr: [], // 开始加载的文件的总进度信息\r\n    downloadCompleteCountArr: [], // 开始加载的文件的完成进度信息\r\n    downloadProgress: 0, // 加载进度\r\n    openId: null,  //用户openId\r\n    weChatKey: [  // 用于查询开放域排行榜数据的Key值\r\n        \"bonusPoint\",\r\n        \"masterPoint\",\r\n        \"answerTime\",\r\n    ],\r\n    RankHeight: [  // 设置子域可视高度\r\n        320,\r\n    ],\r\n    shareTicket: null,\r\n    scene: null, //场景值\r\n    _initGroupRankIndex: 0, //群排行界面初始序列\r\n    _isReadyGroupRank: true,\r\n    _isShowGroupRank: false,\r\n    _groupRankNode: null,\r\n    _groupRankCanvasWidth: 801,\r\n    _groupRankCanvasHeight: 401.951,\r\n    _isCollect: false,  //用户是否已经收藏小游戏\r\n    _queryData: null,  //卡片分享中的数据\r\n    init() {\r\n        var self = this;\r\n        if (this.inited) {\r\n            return;\r\n        }\r\n        this.requestURL = cc.vv.const.WX_REQUEST_URL;\r\n\r\n        this.keepScreenOn();\r\n\r\n        wx.onHide(function () {\r\n            console.log('[wx.onHide] callback');\r\n            var groupRankNode = cc.find(\"Canvas/group_rank\");\r\n            self._groupRankNode = groupRankNode;\r\n            if (groupRankNode) {\r\n                self._isShowGroupRank = true;\r\n                self._isReadyGroupRank = true;\r\n            } else {\r\n                self._isShowGroupRank = false;\r\n            }\r\n            // 通知切后台\r\n            cc.vv.gameEvent.dispatchEvent(cc.vv.gameEvent.EVENT_ENTER_BACKGROUND);\r\n        });\r\n\r\n        wx.onShow(function (res) {\r\n\r\n            console.log('[wx.onShow] callback');\r\n            console.log(res);\r\n\r\n            // 关掉再回来需要重新设置常亮\r\n            self.keepScreenOn();\r\n\r\n            if (res.scene == cc.vv.const.WX_SCENE_VALUE_1044) {\r\n                if (!cc.vv.matchData.isMatch() && cc.vv.myself.guideStep == 2) {\r\n                    if (typeof res.query.inviterId != \"undefined\") {\r\n                        if (self._isReadyGroupRank) {\r\n                            wx.postMessage({\r\n                                command: \"groupRank\",\r\n                                shareTicket: res.shareTicket,\r\n                                keyData: self.weChatKey,\r\n                                myOpenId: self.openId,\r\n                                initGroupIndex: self._initGroupRankIndex,\r\n                            });\r\n                            if (self._isShowGroupRank) {\r\n                                self._groupRankNode.getComponent(\"GroupRank\").initView(self._initGroupRankIndex, true);\r\n                            }\r\n                            if (!self._isShowGroupRank) {\r\n                                if (res.query.inviterInitType == '1' && res.query.inviterInitModule == cc.vv.enum.EnumInitView.EIV_GROUP\r\n                                    && res.query.inviterInitType && res.query.inviterInitModule) {\r\n                                    cc.vv.utils.createPrefabByUrl(cc.vv.const.URL_GROUP_RANK, null, function (node) {\r\n                                        node.getComponent(\"GroupRank\").initView(self._initGroupRankIndex, true);\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // 通过查询字符串链接进入\r\n            if (res.query) {\r\n                self._queryData = res.query;\r\n                cc.vv.gameEvent.dispatchEvent(cc.vv.gameEvent.EVENT_WX_QUERY, res.query);\r\n            }\r\n            if (res.scene == cc.vv.const.WX_SCENE_VALUE_1104) {\r\n                self._isCollect = true;\r\n            }\r\n\r\n            // 发起重连\r\n            cc.vv.gameNetMgr.tryReconnectLogicServer();\r\n\r\n            // 通知切前台\r\n            cc.vv.gameEvent.dispatchEvent(cc.vv.gameEvent.EVENT_ENTER_FOREGROUND);\r\n        });\r\n\r\n        wx.onAudioInterruptionBegin(function () {\r\n            console.log('[wx.onAudioInterruptionBegin] callback');\r\n\r\n            cc.vv.gameEvent.dispatchEvent(cc.vv.gameEvent.EVENT_AUDIO_INTERRUPTION_BEGIN);\r\n        });\r\n\r\n        wx.onAudioInterruptionEnd(function () {\r\n            console.log('[wx.onAudioInterruptionEnd] callback');\r\n\r\n            cc.vv.gameEvent.dispatchEvent(cc.vv.gameEvent.EVENT_AUDIO_INTERRUPTION_END);\r\n        });\r\n\r\n        // 右上角转发\r\n        wx.onShareAppMessage(function () {\r\n            var query = '';\r\n            if (typeof cc.vv != 'undefined'\r\n                && typeof cc.vv.myself != 'undefined'\r\n                && typeof cc.vv.myself.playerId != 'undefined'\r\n                && typeof cc.vv.myself.playerName != 'undefined') {\r\n                query = 'inviterId=' + cc.vv.myself.playerId + '&inviterName=' + cc.vv.myself.playerName;\r\n            }\r\n\r\n            return {\r\n                title: cc.vv.lan.SHARE_TITLE_GAME,\r\n                query: query,\r\n                imageUrl: cc.vv.const.WX_SHARE_GAME_URL,\r\n            }\r\n        });\r\n\r\n        if (typeof wx.getUpdateManager === 'function') {\r\n            const updateManager = wx.getUpdateManager();\r\n            updateManager.onCheckForUpdate(function (res) {\r\n                // 请求完新版本信息的回调\r\n                console.log('[wx.onCheckForUpdate]');\r\n                console.log(res.hasUpdate);\r\n            });\r\n\r\n            updateManager.onUpdateReady(function () {\r\n                console.log('[wx.onUpdateReady]');\r\n                // 新的版本已经下载好，调用 applyUpdate 应用新版本并重启\r\n                updateManager.applyUpdate();\r\n            });\r\n\r\n            updateManager.onUpdateFailed(function () {\r\n                // 新的版本下载失败\r\n                console.log('[wx.onUpdateFailed]');\r\n            });\r\n        }\r\n\r\n        this.inited = true;\r\n    },\r\n\r\n    iswxPlatform() {\r\n        return cc.sys.platform === cc.sys.WECHAT_GAME;\r\n    },\r\n\r\n    setClipboardData(data, _callback) {\r\n        if (this.iswxPlatform()) {\r\n            wx.setClipboardData({\r\n                data: data,\r\n                success: function (res) {\r\n                    if (typeof _callback == \"function\") {\r\n                        _callback();\r\n                    }\r\n                },\r\n            });\r\n        } else {\r\n            var save = function (e) {\r\n                e.clipboardData.setData('text/plain', data);\r\n                e.preventDefault();\r\n            }.bind(this);\r\n            document.addEventListener('copy', save);\r\n            document.execCommand('copy');\r\n            document.removeEventListener('copy', save);\r\n        }\r\n    },\r\n\r\n    showLoading(title, mask) {\r\n\r\n        console.log('[WXHelper.showLoading]');\r\n\r\n        // if (this.isLoadingShow){\r\n        //     return;\r\n        // }\r\n\r\n        // console.log('[wx.showLoading]');\r\n\r\n        // wx.showLoading({\r\n        //     title: title,\r\n        //     mask: mask,\r\n        //     // success:function(res){\r\n\r\n        //     // },\r\n        //     // fail:function(){\r\n\r\n        //     // },\r\n        //     // complete:function(){\r\n\r\n        //     // },\r\n        // });\r\n\r\n        // this.isLoadingShow = true;\r\n    },\r\n\r\n    hideLoading() {\r\n        console.log('[WXHelper.hideLoading]');\r\n        if (this.isLoadingShow) {\r\n            console.log('[wx.hideLoading]');\r\n            wx.hideLoading();\r\n            this.isLoadingShow = false;\r\n        }\r\n    },\r\n\r\n    // 显示转发\r\n    showShareMenu() {\r\n        console.log('[WXHelper.showShareMenu]');\r\n        wx.showShareMenu();\r\n    },\r\n\r\n    updateShareMenu(type, _callback) {\r\n        wx.updateShareMenu({\r\n            withShareTicket: type,\r\n            success: function (res) {\r\n                console.log(\"updateShareMenu success\");\r\n                if (typeof _callback == \"function\") {\r\n                    _callback();\r\n                }\r\n            },\r\n            fail: function (res) {\r\n                console.log(\"updateShareMenu fail\");\r\n            },\r\n        });\r\n    },\r\n\r\n    getShareInfo(type, _callback) {\r\n        var self = this;\r\n        wx.getShareInfo({\r\n            shareTicket: type,\r\n            success: function (res) {\r\n                console.log(\"getShareInfo success\");\r\n                console.log(res)\r\n                var errMsg = res.errMsg;\r\n                var encryptedData = res.encryptedData;\r\n                var iv = res.iv;\r\n\r\n                wx.request({\r\n                    url: self.requestURL + 'decrypt',\r\n                    data: {\r\n                        sessionID: self.sessionID,\r\n                        encryptedData: encryptedData,\r\n                        iv: iv,\r\n                    },\r\n                    // header:{},\r\n                    method: 'POST',\r\n                    // dataType:'json',\r\n                    // responseType:'text',\r\n                    success: function (res) {\r\n                        console.log('[wx.getUserInfo.request] success.');\r\n                        console.log(res);\r\n                        console.log(res.data);\r\n                        if (res.statusCode === 200) {\r\n                            if (typeof _callback == \"function\") {\r\n                                _callback(res.data.Data.openGId);\r\n                            }\r\n                        }\r\n                    },\r\n                    fail: function () {\r\n                        console.log('[wx.getShareInfo.request] fail.');\r\n                    },\r\n                    complete: function () {\r\n                        console.log('[wx.getShareInfo.request] complete.');\r\n                    },\r\n                })\r\n\r\n\r\n            },\r\n            fail: function (res) {\r\n                console.log(\"getShareInfo fail\");\r\n            },\r\n            complete: function (res) {\r\n                console.log(\"getShareInfo complete\");\r\n\r\n            },\r\n        });\r\n    },\r\n\r\n    // 隐藏转发\r\n    hideShareMenu() {\r\n        console.log('[WXHelper.hideShareMenu]');\r\n        wx.hideShareMenu();\r\n    },\r\n\r\n    // 主动转发，截屏\r\n    shareAppMessageScn(title, shareTicket) {\r\n        console.log('[WXHelper.shareAppMessageScn]');\r\n\r\n        wx.updateShareMenu({\r\n            withShareTicket: shareTicket,\r\n            success: function (res) {\r\n                wx.shareAppMessage({\r\n                    // title:'这是一个测试分享标题！如果这个标题很长很长很长很长很长很长很长很长很长很长很长很长很长很长\\n很长很长很长很长很长很长很长很长很长很长会怎么显示？',\r\n                    title: title,\r\n                    imageUrl: canvas.toTempFilePathSync({\r\n                        // destWidth:500,\r\n                        // destHeight:400,\r\n                        destWidth: 1280,\r\n                        destHeight: 720,\r\n                    }),\r\n                    success: function (res) {\r\n                        console.log('[wx.shareAppMessage] success.');\r\n                        console.log(res);\r\n                    },\r\n                    fail: function (res) {\r\n                        console.log('[wx.shareAppMessage] fail.');\r\n                        console.log(res);\r\n                    },\r\n                    complete: function (res) {\r\n                        console.log('[wx.shareAppMessage] complete.');\r\n                        console.log(res);\r\n                    },\r\n                });\r\n            },\r\n        });\r\n\r\n    },\r\n\r\n    // 主动转发，仅标题\r\n    shareAppMessage(title, imageUrl) {\r\n        console.log('[WXHelper.shareAppMessage]');\r\n        wx.shareAppMessage({\r\n            title: title,\r\n            imageUrl: imageUrl,\r\n            success: function (res) {\r\n                console.log('[wx.shareAppMessage] success.');\r\n                console.log(res);\r\n            },\r\n            fail: function (res) {\r\n                console.log('[wx.shareAppMessage] fail.');\r\n                console.log(res);\r\n            },\r\n            complete: function (res) {\r\n                console.log('[wx.shareAppMessage] complete.');\r\n                console.log(res);\r\n            },\r\n        });\r\n    },\r\n\r\n    // 主动转发，带查询字符串\r\n    // @param query 类似 k1=v1&k2=v2 格式\r\n    shareAppMessageQuery(title, imageUrl, query, successCallback, failCallback, sceneID) {\r\n        var pw = new PacketWriter();\r\n        pw.writeid(cc.vv.packid.PACKETID_249);\r\n        pw.writeu2(sceneID);\r\n        pw.writeu1(1);\r\n        cc.vv.socketMgr.bufferPack(pw.getdata());\r\n        console.log('[WXHelper.shareAppMessageQuery]');\r\n        console.log(query);\r\n        wx.shareAppMessage({\r\n            title: title,\r\n            query: query,\r\n            imageUrl: imageUrl,\r\n            success: function (res) {\r\n                console.log(res);\r\n                console.log('[wx.shareAppMessage] success.');\r\n                var pw = new PacketWriter();\r\n                pw.writeid(cc.vv.packid.PACKETID_249);\r\n                pw.writeu2(sceneID);\r\n                pw.writeu1(3);\r\n                cc.vv.socketMgr.bufferPack(pw.getdata());\r\n                if (typeof successCallback === \"function\") {\r\n                    successCallback(res);\r\n                }\r\n            },\r\n            fail: function (res) {\r\n                console.log(res);\r\n                console.log('[wx.shareAppMessage] fail.');\r\n                if (typeof failCallback === \"function\") {\r\n                    failCallback();\r\n                }\r\n            },\r\n            complete: function (res) {\r\n                console.log('[wx.shareAppMessage] complete.');\r\n                console.log(res);\r\n            },\r\n        });\r\n    },\r\n\r\n    // 监听转发事件\r\n    // onShareAppMessage(){\r\n    //     // 用户点击了“转发”按钮\r\n    //     wx.onShareAppMessage(function(){\r\n    //         return {\r\n    //             title:'',\r\n    //         }\r\n    //     });\r\n    // }\r\n\r\n    // 对外提供的登录接口\r\n    login() {\r\n\r\n        console.log('[WXHelper.login]');\r\n\r\n        // 读取本地缓存的sessionid\r\n        // this.loadLocalSessionID();\r\n\r\n        // 先获取授权\r\n        this._authorize();\r\n    },\r\n\r\n    // 调用微信登录\r\n    _login(_successCb) {\r\n        if (typeof _successCb === \"function\") {\r\n            var successCb = _successCb;\r\n        }\r\n        console.log('[WXHelper._login]');\r\n\r\n        wx.getSetting({\r\n            success: function (res) {\r\n                if (!res.authSetting['scope.userInfo']) {\r\n                    var [screenWidth, screenHeight] = [0, 0];\r\n                    wx.getSystemInfo({\r\n                        success: function (res) {\r\n                            screenWidth = res.screenWidth;\r\n                            screenHeight = res.screenHeight;\r\n                        },\r\n                        fail: function () {\r\n                            console.log('[wx.getSystemInfo] fail.');\r\n                        },\r\n                    });\r\n                    var imgurl = cc.url.raw(cc.GameTexture.wxmingamelogin);\r\n                    const userInfoBtn = wx.createUserInfoButton({\r\n                        type: 'image',\r\n                        image: imgurl,\r\n                        text: '登陆游戏',\r\n                        style: {\r\n                            left: screenWidth / 2 - cc.GameTexture.wxmingamelogin_width / 2,\r\n                            top: screenHeight / 2 - cc.GameTexture.wxmingamelogin_height / 2,\r\n                            width: cc.GameTexture.wxmingamelogin_width,\r\n                            height: cc.GameTexture.wxmingamelogin_height,\r\n                            borderRadius: 4\r\n                        }\r\n                    })\r\n                    userInfoBtn.onTap((res) => {\r\n                        wx.authorize({\r\n                            scope: 'scope.userInfo',\r\n                            success: function () {\r\n                                console.log('[wx.authorize] success.');\r\n                                userInfoBtn.destroy();\r\n                                successCb();\r\n                            },\r\n                            fail: function () {\r\n                                console.log('[wx.authorize] fail.');\r\n                            },\r\n                            complete: function () {\r\n                                console.log('[wx.authorize] complete.');\r\n                            },\r\n                        });\r\n                    })\r\n                }\r\n                else {\r\n                    console.log('authorized.');\r\n                    successCb();\r\n                }\r\n            },\r\n            fail: function (res) {\r\n                console.log('[wx.getSetting] fail.');\r\n            },\r\n            complete: function (res) {\r\n                console.log('[wx.getSetting] complete.');\r\n            },\r\n        });\r\n    },\r\n\r\n    // 获取与开发服务器通讯的sessionid\r\n    loadLocalSessionID() {\r\n\r\n        console.log('[WXHelper.loadLocalSessionID]');\r\n\r\n        if (this.sessionID == null) {\r\n            var session = wx.getStorageSync('SESSION_ID');\r\n            if (session) {\r\n                this.sessionID = session;\r\n                console.log('[WXHelper.loadLocalSessionID] ' + this.sessionID);\r\n            }\r\n            else {\r\n                console.log('[WXHelper.loadLocalSessionID] get sessionid fail.');\r\n            }\r\n        }\r\n    },\r\n\r\n    // 请求用户信息\r\n    _getUserInfo(successCb, failCb) {\r\n\r\n        console.log('[WXHelper._getUserInfo]');\r\n\r\n        // if (this.sessionID === null) {\r\n        //     this.login();\r\n        //     return;\r\n        // }\r\n\r\n        // var self = this;\r\n\r\n        // console.log('[wx.getUserInfo]');\r\n\r\n        // api: https://developers.weixin.qq.com/miniprogram/dev/api/open.html#wxgetuserinfoobject\r\n        wx.getUserInfo({\r\n\r\n            withCredentials: true, //是否带上登录态信息 值为true才有openid\r\n\r\n            success: (res) => {\r\n                this.userInfoObj = res;\r\n                console.log(\"[wx.getUserInfo success]\");\r\n                if (typeof successCb === \"function\") {\r\n                    successCb();\r\n                }\r\n                // var rawData = res.rawData;\r\n                // var encryptedData = res.encryptedData;\r\n                // var signature = res.signature;\r\n                // var iv = res.iv;\r\n\r\n                // console.log('[wx.request]');\r\n\r\n                // wx.request({\r\n                //     url: self.requestURL + 'decrypt',\r\n                //     data: {\r\n                //         sessionID: self.sessionID,\r\n                //         rawData: rawData,\r\n                //         signature: signature,\r\n                //         encryptedData: encryptedData,\r\n                //         iv: iv,\r\n                //     },\r\n                //     // header:{},\r\n                //     method: 'POST',\r\n                //     // dataType:'json',\r\n                //     // responseType:'text',\r\n                //     success: function (res) {\r\n                //         // res.data Object/String/ArrayBuffer\r\n                //         // res.statusCode  Number\r\n                //         // res.header Object\r\n\r\n                //         console.log('[wx.getUserInfo.request] success.');\r\n                //         console.log(res);\r\n                //         console.log(res.data);\r\n\r\n                //         // #######################\r\n                //         // 最终登入成功的回调在这里\r\n\r\n                //         if (res.statusCode === 200) {\r\n\r\n                //             /** Login Protocol\r\n                //              *  C->S\r\n                //                 {\r\n                //                     String openid\r\n                //                     String unionid\r\n                //                     String 名字\r\n                //                     String 头像URL(微信中获取)\r\n                //                     Uint8  性别（0=未知/1=男/2=女）\r\n                //                     Uint32 平台id\r\n                //                     String 客户端版本号\r\n                //                     Uint64 邀请者id（通过分享链接点开）\r\n                //                 }\r\n                //              * \r\n                //              */\r\n                //             var openId = res.data.Data.openId;\r\n                //             self.openId = openId;\r\n                //             var nickName = res.data.Data.nickName;\r\n                //             var avatarUrl = res.data.Data.avatarUrl;\r\n                //             var platformId = 0;\r\n                //             var versionNum = '1.0.0';\r\n                //             var unionId = '';\r\n                //             var gender = res.data.Data.gender;\r\n                //             var inviterId = 0;\r\n                //             var inviterName = \"\";\r\n                //             var inviterMatchId = 0;\r\n\r\n\r\n                //             if (typeof res.data.Data.unionId !== 'undefined') {\r\n                //                 unionId = res.data.Data.unionId;\r\n                //             }\r\n\r\n                //             var launchOption = wx.getLaunchOptionsSync();\r\n                //             var query = launchOption.query;\r\n\r\n                //             if (launchOption.scene == \"1104\") { //场景值 ： 从我的小程序入口进入\r\n                //                 self._isCollect = true;\r\n                //             }\r\n                //             console.log(\"wx launch option:\");\r\n                //             console.log(launchOption);\r\n\r\n                //             if (\"undefined\" !== typeof query\r\n                //                 && \"undefined\" !== typeof query.inviterId\r\n                //                 && \"undefined\" !== typeof query.inviterName) {\r\n                //                 if (launchOption.scene == \"1044\") { //场景值 ： 带shareTicket 的小程序消息卡片\r\n                //                     if (query.inviterInitType == '1' && query.inviterInitModule == 0\r\n                //                         && query.inviterInitType && query.inviterInitModule) {\r\n                //                         self.shareTicket = launchOption.shareTicket;\r\n                //                     }\r\n                //                 }\r\n                //                 inviterId = parseInt(query.inviterId);\r\n                //                 inviterName = query.inviterName;\r\n                //             }\r\n                //             var pw = new PacketWriter();\r\n                //             pw.writeid(cc.vv.packid.PACKETID_100);\r\n                //             pw.writes(openId);\r\n                //             pw.writes(unionId);\r\n                //             pw.writes(nickName);\r\n                //             pw.writes(avatarUrl);\r\n                //             pw.writeu1(gender);\r\n                //             pw.writeu4(platformId);\r\n                //             pw.writes(versionNum);\r\n                //             pw.writeu8(inviterId);\r\n                //             pw.writes(inviterName);\r\n                //             if (\"undefined\" !== typeof query.inviterMatchId) {\r\n                //                 inviterMatchId = query.inviterMatchId;\r\n                //                 pw.writeu4(inviterMatchId);\r\n                //             } else {\r\n                //                 pw.writeu4(0);\r\n                //             }\r\n                //             if (\"undefined\" !== typeof query.inviterSceneID) {\r\n                //                 var sceneID = Number(query.inviterSceneID);\r\n                //                 pw.writeu2(sceneID);\r\n                //                 console.log(\"场景ID___\" + sceneID);\r\n                //             }\r\n                //             cc.vv.socketMgr.bufferPack(pw.getdata());\r\n\r\n                //             console.log('[wx.getUserInfo.request] send login request to logic server.');\r\n                //         }\r\n                //     },\r\n                //     fail: function () {\r\n                //         console.log('[wx.getUserInfo.request] fail.');\r\n                //     },\r\n                //     complete: function () {\r\n                //         console.log('[wx.getUserInfo.request] complete.');\r\n                //     },\r\n                // });\r\n            },\r\n        });\r\n    },\r\n\r\n\r\n\r\n\r\n    // 登陆时候下载资源\r\n    // downloadAllResources(target, callFunc){\r\n    //     var relatUrl = 'res';\r\n    //     var remoteUrl = wxDownloader.REMOTE_SERVER_ROOT + relatUrl + '.zip';\r\n    //     var localPath = wx.env.USER_DATA_PATH;\r\n    //     var versionUrl = `${wx.env.USER_DATA_PATH}/res_version.txt`;\r\n    //     console.log('--------------->' + remoteUrl);\r\n    //     var self = this;\r\n    //     var fs = wx.getFileSystemManager();\r\n    //     fs.access({\r\n    //         path: localPath + '/' + relatUrl,\r\n    //         success: function () {\r\n    //             console.log('[FileSystemManager.access] success.');\r\n\r\n    //             fs.access({\r\n    //                 path: versionUrl,\r\n    //                 success: function () {\r\n    //                     console.log('[FileSystemManager.access versionUrl] success.');\r\n\r\n    //                     var resVersionStr = fs.readFileSync(versionUrl, 'utf8');\r\n    //                     if (resVersionStr == wxDownloader.REMOTE_SERVER_ROOT) {\r\n    //                         cc.director.loadScene(\"match\");\r\n    //                     } else {\r\n    //                         fs.unlinkSync(versionUrl);\r\n    //                         self.startDownloadRes(target, callFunc, remoteUrl, localPath, versionUrl);\r\n    //                     }\r\n    //                 },\r\n    //                 fail: function () {\r\n    //                     console.log('[FileSystemManager.access versionUrl] fail.');\r\n\r\n    //                     self.startDownloadRes(target, callFunc, remoteUrl, localPath, versionUrl);\r\n    //                 },\r\n    //                 complete: function () {\r\n    //                     console.log('[FileSystemManager.access versionUrl] complete.');\r\n    //                 }\r\n    //             });\r\n    //         },\r\n    //         fail: function (res) {\r\n    //             console.log(\"[FileSystemManager.access] fail...\" + res.errMsg);\r\n\r\n    //             self.startDownloadRes(target, callFunc, remoteUrl, localPath, versionUrl);\r\n    //         }\r\n    //     });\r\n    // },\r\n\r\n    // // 开始下载\r\n    // startDownloadRes: function (target, callFunc, remoteUrl, localPath, versionUrl) {\r\n    //     var fs = wx.getFileSystemManager();\r\n    //     var downloadTask = wx.downloadFile({\r\n    //         url: remoteUrl,\r\n    //         header: {},\r\n    //         filePath: '',\r\n    //         success: function (res) {\r\n    //             console.log('[wx.downloadfile] success.' + '   ' + res.tempFilePath + '   ' + res.statusCode);\r\n\r\n    //             if (res.statusCode === 404) {\r\n    //                 console.log(\"Download file failed: \" + remoteUrl);\r\n    //             }\r\n    //             else if (res.tempFilePath) {\r\n    //                 // http reading is not cached\r\n    //                 console.log('---------->' + localPath);\r\n    //                 fs.unzip({\r\n    //                     zipFilePath: res.tempFilePath,\r\n    //                     targetPath: localPath,\r\n    //                     success: function () {\r\n    //                         console.log(\"[FileSystemManager.unzip] success.\");\r\n\r\n    //                         fs.writeFileSync(versionUrl, wxDownloader.REMOTE_SERVER_ROOT, 'utf8');\r\n\r\n    //                         cc.director.loadScene(\"match\");\r\n    //                     },\r\n    //                     fail: function () {\r\n    //                         console.log(\"[FileSystemManager.unzip] fail.\");\r\n\r\n    //                         cc.director.loadScene(\"match\");\r\n    //                     },\r\n    //                     complete: function () {\r\n    //                         console.log(\"[FileSystemManager.unzip] complete.\");\r\n    //                     },\r\n    //                 });\r\n    //             }\r\n    //         },\r\n    //         fail: function () {\r\n    //             console.log('[wx.downloadfile] fail.');\r\n\r\n    //             cc.director.loadScene(\"match\");\r\n    //         },\r\n    //         complete: function () {\r\n    //             console.log('[wx.downloadfile] complete.');\r\n    //         },\r\n    //     });\r\n    //     downloadTask.onProgressUpdate((res) => {\r\n    //         // that.setData({\r\n    //         //     percentVal: res.progress\r\n    //         // });\r\n    //         console.log('下载进度', res.progress)\r\n    //         console.log('已经下载的数据长度', res.totalBytesWritten)\r\n    //         console.log('预期需要下载的数据总长度', res.totalBytesExpectedToWrite)\r\n    //         if (callFunc) {\r\n    //             callFunc(target, res.progress);\r\n    //         }\r\n    //     });\r\n    // },\r\n\r\n    // 登陆时候下载资源\r\n    downloadAllResources(target, callFunc) {\r\n        var fileArr = cc.GameConst.URL_RES_INCLUDE_FILE;\r\n        // var spriteArr = cc.GameConst.URL_RES_INCLUDE_SPRITE_ATLAS;\r\n        this.downloadTotalCountArr = [];\r\n        this.downloadCompleteCountArr = [];\r\n        this.downloadProgress = 0;\r\n        var self = this;\r\n        for (var i = 0; i < fileArr.length; i++) {\r\n            self.downloadTotalCountArr[i] = 0;\r\n            self.downloadCompleteCountArr[i] = 0;\r\n            (function (i) {\r\n                cc.loader.loadResDir(fileArr[i], function (completedCount, totalCount, item) {\r\n                    // console.log('----------------->' + fileArr[i] + '...   ' + completedCount + '/' + totalCount);\r\n                    self.dealDownloadProgress(self, i, completedCount, totalCount);\r\n                    if (callFunc) {\r\n                        callFunc(target, self.downloadProgress);\r\n                    }\r\n                },\r\n                    function (err, assets) {\r\n                        if (err) {\r\n                            cc.error(err);\r\n                            return;\r\n                        }\r\n\r\n                        console.log('[cc.loader.loadResDir] complete...' + fileArr[i]);\r\n                        // console.log(self.downloadCompleteCountArr);\r\n                        // console.log(self.downloadTotalCountArr);\r\n                        // cc.director.loadScene(\"match\");\r\n                    });\r\n            })(i);\r\n        }\r\n        // for (var i = 0; i < spriteArr.length; i++) {\r\n        //     self.downloadTotalCountArr[fileArr.length + i] = 0;\r\n        //     self.downloadCompleteCountArr[fileArr.length + i] = 0;\r\n        //     (function (i) {\r\n        //         cc.loader.loadResDir(spriteArr[i], cc.SpriteFrame, function (completedCount, totalCount, item) {\r\n        //             // console.log('----------------->' + spriteArr[i] + '...   ' + completedCount + '/' + totalCount);\r\n        //             self.dealDownloadProgress(self, fileArr.length + i, completedCount, totalCount);\r\n        //             if (callFunc) {\r\n        //                 callFunc(target, self.downloadProgress);\r\n        //             }\r\n        //         },\r\n        //             function (err, assets) {\r\n        //                 if (err) {\r\n        //                     cc.error(err);\r\n        //                     return;\r\n        //                 }\r\n\r\n        //                 console.log('[cc.loader.loadResDir] complete...' + spriteArr[i]);\r\n        //                 // console.log(self.downloadCompleteCountArr);\r\n        //                 // console.log(self.downloadTotalCountArr);\r\n        //                 // cc.director.loadScene(\"match\");\r\n        //             });\r\n        //     })(i);\r\n        // }\r\n\r\n        // 加载战斗界面预制件\r\n        // cc.loader.loadRes('prefabs/mj_battle_room_node', function () {\r\n        //     // console.log('---------->load battle room done');\r\n        // });\r\n    },\r\n\r\n    // 处理加载资源进度信息\r\n    dealDownloadProgress: function (target, index, completedCount, totalCount) {\r\n        target.downloadTotalCountArr[index] = totalCount;\r\n        target.downloadCompleteCountArr[index] = completedCount;\r\n\r\n        if (cc.GameConst.URL_RES_INCLUDE_FILE.length == target.downloadTotalCountArr.length) {\r\n            var cur = target.getProgress(target.downloadCompleteCountArr);\r\n            var max = target.getProgress(target.downloadTotalCountArr);\r\n            this.downloadProgress = (Math.floor(cur / max * 100) >= this.downloadProgress) ? Math.floor(cur / max * 100) : this.downloadProgress;\r\n            // console.log('========================>all file download progress: ' + cur + ' / ' + max + '....' + this.downloadProgress + '%');\r\n        }\r\n    },\r\n\r\n    // 获得进度值\r\n    getProgress: function (arr) {\r\n        var num = 0;\r\n        for (var i = 0; i < arr.length; i++) {\r\n            num += arr[i];\r\n        }\r\n        return num;\r\n    },\r\n\r\n    setShareCanvasGameAwardData(command, masterPoint, bonus, totalBonus) {\r\n        wx.postMessage({\r\n            command: command,\r\n            nickName: cc.vv.utils.getSubstringDataByLength(cc.vv.myself.playerName),\r\n            headImgUrl: cc.vv.myself.playerIcon,\r\n            masterPoint: masterPoint,\r\n            bonus: bonus,\r\n            totalBonus: totalBonus,\r\n        });\r\n    },\r\n\r\n    getCustomShareCanvasToShare(title, query, sceneID) {\r\n        sharedCanvas.toTempFilePath({\r\n            x: 0,\r\n            y: 0,\r\n            width: sharedCanvas.width,\r\n            height: sharedCanvas.height,\r\n            destWidth: 1000,\r\n            destHeight: 800,\r\n            fileType: \"png\",\r\n            quality: -1.0,\r\n            success: function (res) {\r\n                var imageUrl = res.tempFilePath;\r\n                wx.updateShareMenu({\r\n                    withShareTicket: false,\r\n                    success: function (res) {\r\n                        var pw = new PacketWriter();\r\n                        pw.writeid(cc.vv.packid.PACKETID_249);\r\n                        pw.writeu2(sceneID);\r\n                        pw.writeu1(1);\r\n                        cc.vv.socketMgr.bufferPack(pw.getdata());\r\n                        wx.shareAppMessage({\r\n                            title: title,\r\n                            imageUrl: imageUrl,\r\n                            query: query,\r\n                            success: function (res) {\r\n                                var pw = new PacketWriter();\r\n                                pw.writeid(cc.vv.packid.PACKETID_249);\r\n                                pw.writeu2(sceneID);\r\n                                pw.writeu1(3);\r\n                                cc.vv.socketMgr.bufferPack(pw.getdata());\r\n                            },\r\n                        })\r\n                    },\r\n                });\r\n            }\r\n        });\r\n    },\r\n\r\n    //TODO: 对用户拒接授权的处理，wx.createOpenSettingButton  由于官方打开小程序设置页接口，故只能通过创建设置按钮实现再次授权相册\r\n    // api: https://developers.weixin.qq.com/blogdetail?action=get_post_info&lang=zh_CN&token=356396510&docid=00082244e20898b040073de6e5b801\r\n    getScreenCanvasToLocalPath(successCallback, failCallBack) {\r\n        var self = this;\r\n        if (!wx.saveImageToPhotosAlbum) {\r\n            wx.showModal({\r\n                title: '提示',\r\n                content: '当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'\r\n            })\r\n            return;\r\n        }\r\n        wx.getSetting({\r\n            success(res) {\r\n                console.log(\"getSetting: success\");\r\n                if (!res.authSetting['scope.writePhotosAlbum']) {\r\n                    console.log(\"1-没有授权《保存图片》权限\");\r\n                    // 接口调用询问  \r\n                    wx.authorize({\r\n                        scope: 'scope.writePhotosAlbum',\r\n                        success() {\r\n                            console.log(\"2-授权《保存图片》权限成功\");\r\n                            var tempFilePath = canvas.toTempFilePathSync({\r\n                                x: 0,\r\n                                y: 0,\r\n                                width: canvas.width,\r\n                                height: canvas.height,\r\n                                destWidth: 1280,\r\n                                destHeight: 720,\r\n                                fileType: \"png\",\r\n                                quality: -1.0,\r\n                            })\r\n                            wx.saveImageToPhotosAlbum({\r\n                                filePath: tempFilePath,\r\n                                success: function (res) {\r\n                                    if (successCallback != null) {\r\n                                        successCallback();\r\n                                    }\r\n                                }\r\n                            });\r\n                        },\r\n                        fail() {\r\n                            console.log(\"用户拒绝了授权\");\r\n                            if (failCallBack != null) {\r\n                                failCallBack();\r\n                            }\r\n                        },\r\n                    });\r\n                } else {\r\n                    console.log(\"1-已经授权《保存图片》权限\");\r\n                    var tempFilePath = canvas.toTempFilePathSync({\r\n                        x: 0,\r\n                        y: 0,\r\n                        width: canvas.width,\r\n                        height: canvas.height,\r\n                        destWidth: canvas.width,\r\n                        destHeight: canvas.height,\r\n                        fileType: \"png\",\r\n                        quality: -1.0,\r\n                    })\r\n                    wx.saveImageToPhotosAlbum({\r\n                        filePath: tempFilePath,\r\n                        success: function (res) {\r\n                            if (successCallback != null) {\r\n                                successCallback();\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            },\r\n        })\r\n    },\r\n\r\n    //TODO: 由于微信不支持把临时文件保存到子域res文件夹，子域也不能访问主域的res文件夹\r\n    //帖子链接：https://developers.weixin.qq.com/blogdetail?action=get_post_info&lang=zh_CN&token=1608975854&docid=00048689504138cd3007e49ea56800\r\n    //2.creator的加载远程资源的接口仅支持加载:图片（cc.Texture2D），声音（cc.AudioClip），粒子（cc.ParticleAsset）\r\n    //api http://docs.cocos.com/creator/manual/zh/scripting/load-assets.html\r\n    downloadSharedCanvasResources() {\r\n        var fs = wx.getFileSystemManager();\r\n        wx.downloadFile({\r\n            url: wxDownloader.REMOTE_SERVER_ROOT + 'fzmj_match_sharedCanvas_res/share_bg.png', //仅为示例，并非真实的资源\r\n            success: function (res) {\r\n                // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容\r\n                if (res.statusCode === 200) {\r\n                    wx.postMessage({\r\n                        command: 'bgRes',\r\n                        path: res.tempFilePath\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        wx.downloadFile({\r\n            url: wxDownloader.REMOTE_SERVER_ROOT + 'fzmj_match_sharedCanvas_res/yuan.png', //仅为示例，并非真实的资源\r\n            success: function (res) {\r\n                // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容\r\n                if (res.statusCode === 200) {\r\n                    wx.postMessage({\r\n                        command: 'yuanRes',\r\n                        path: res.tempFilePath\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    },\r\n\r\n    getFriendRank() {\r\n        wx.postMessage({\r\n            command: \"friendRank\",\r\n            keyData: [this.weChatKey[0], this.weChatKey[1]],\r\n        });\r\n    },\r\n\r\n    getAnswerRank() {\r\n        wx.postMessage({\r\n            command: \"getAnswerChange\",\r\n            keyData: this.weChatKey[2],\r\n            myOpenId: this.openId,\r\n            myName: cc.vv.myself.playerName,\r\n            myHeadUrl: cc.vv.myself.playerIcon,\r\n            myTime: cc.vv.myself.answerCounTime,\r\n        });\r\n    },\r\n\r\n    friendRankPageActiveChange(index) {\r\n        wx.postMessage({\r\n            command: \"pageChange\",\r\n            pIndex: index,\r\n            myOpenId: this.openId\r\n        });\r\n    },\r\n\r\n    setRankHeight(index) {\r\n        wx.postMessage({\r\n            command: \"RankHeight\",\r\n            keyData: this.RankHeight[index],\r\n        });\r\n    },\r\n\r\n    setConfigFriendRankData(keyArr, bonusData, masterPointData, answerTime) {\r\n        wx.postMessage({\r\n            command: 'setRankData',\r\n            keyData: [\r\n                {\r\n                    key: keyArr[0],\r\n                    data: bonusData\r\n                },\r\n                {\r\n                    key: keyArr[1],\r\n                    data: masterPointData\r\n                },\r\n                {\r\n                    key: keyArr[2],\r\n                    data: answerTime\r\n                },\r\n            ],\r\n        });\r\n    },\r\n\r\n    setMoveTouchDeltaY(deltaY) {\r\n        wx.postMessage({\r\n            command: 'moveTouch',\r\n            y: deltaY,\r\n        });\r\n    },\r\n\r\n    setMoveTouchOff() {\r\n        wx.postMessage({\r\n            command: 'moveTouchOff',\r\n        });\r\n    },\r\n\r\n    setSharedCanvasChildrenActive(pIndex) {\r\n        wx.postMessage({\r\n            command: \"shareCanvasChange\",\r\n            pIndex: pIndex\r\n        });\r\n    },\r\n\r\n    setSharedCanvasSize(width, height) {\r\n        sharedCanvas.width = width;\r\n        sharedCanvas.height = height;\r\n    },\r\n\r\n    setSharedCanvasDesignResolution(width, height) {\r\n        wx.postMessage({\r\n            command: 'designResolution',\r\n            designWidth: width,\r\n            designHeight: height,\r\n        });\r\n    },\r\n\r\n    getSurpassFriendData() {\r\n        wx.postMessage({\r\n            command: 'surpassFriendRank',\r\n            keyData: this.weChatKey[0],\r\n            myOpenId: this.openId\r\n        });\r\n    },\r\n\r\n\r\n\r\n    initLoadGroupRankVieW() {\r\n        var self = this;\r\n        wx.postMessage({\r\n            command: \"groupRank\",\r\n            shareTicket: self.shareTicket,\r\n            keyData: self.weChatKey,\r\n            myOpenId: self.openId,\r\n            initGroupIndex: 0,\r\n        });\r\n        self.setSharedCanvasSize(self._groupRankCanvasWidth, self._groupRankCanvasHeight);\r\n        self.setSharedCanvasDesignResolution(self._groupRankCanvasWidth, self._groupRankCanvasHeight);\r\n        self.setSharedCanvasChildrenActive(1);\r\n    },\r\n\r\n    keepScreenOn() {\r\n\r\n        if (wx.setKeepScreenOn) {\r\n            wx.setKeepScreenOn({\r\n                keepScreenOn: true,\r\n                success: function () {\r\n                    console.log('[wx.setKeepScreenOn] success.');\r\n                },\r\n                fail: function () {\r\n                    console.log('[wx.setKeepScreenOn] fail.');\r\n                },\r\n                complete: function () {\r\n                    console.log('[wx.setKeepScreenOn] complete.');\r\n                },\r\n            });\r\n        }\r\n    },\r\n\r\n};\r\nmodule.exports = WXHelper;\r\ncc.WXHelper = WXHelper;"]}